---
output: 
  pdf_document:
    keep_tex: true
header-includes:
    - \usepackage{setspace}\onehalfspacing
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(hrbrthemes)
library(viridis)
library(zoo)
library(stringr)
library(ggrepel)
library(foreign)
library(AER)
library(lmtest)
library(sandwich)
library(texreg)
options(digits = 8)
options(scipen = 999)
rm(list=ls())
```

```{r, echo = F, include=F}
data = read.csv("data1.csv")
logsal = log(data$salary)
educ = data$educ
logbegin = data$salbegin
male = data$male
minority = data$minority
```


# Eksamenssæt 1

## Opgave 1 - Estimer modellen vha. OLS. Kommenter på outputtet og fortolk resultaterne
```{r}
model1 = lm(logsal ~ educ+logbegin+male+minority)
summary(model1)
```

Alle estimater er signifikante på 0,1% bortset fra "Minority", som er signifikant på 1%
F-testen afvises grundet den lave p-værdi angivet ved < 0.000000000000000222, hvilket vil sige at modellene er statistisk signifikant. 
Under antagelsen at alle andre variable er faste, vil en stigning i "educ" (uddannelse) på 1, medfører en stigning i lønnen på 3,5%. Samme princip er gældende for de tre andre variable "logbegin", "male", "minority".
Derudover angiver ovenstående model at $R^2 = 0.77$, hvilket vil sige at dataen passer relativt godt til den estimerede model. 


## Opgave 2 - Udfør grafisk modelkontrol
```{r}
par(mfrow=c(2,2))
plot(model1)
```
Ovenstående er udført grafisk modelkontrol. 
"Residuals vs. Fitted" viser at residualerne ikke er spredte, hvilket er indikation på at der ikke er tale om et "non-linear relationsship". Dog er den røde linje her næsten vandret, hvilket kunne være tegn på det modsatte. 
"Q-Q Residuals" viser at residualerne tilnærmelsesvist følger en ret linje, og derfor antages den at være normal distribueret. 
"Scale-Location" belyser, at der er en skæv "scale-location",hvilket kan indikerer at der er tale om heteroskedasticitet for modellen. Ideelt ønskes at den røde linje er vandret samt at residualspunkterne er spredt og tilfældigt fordelt. 
"Resudials vs. Leverage" tydeliggøre problematikken vedrørende outliers. Her kan der ses tre outliers, hvor nummer 29 ligger med betydelig afstand fra de resterende residualer, og derfor kan det være relevant at re-estimere værdierne igen uden nummer 29, da det kan give et mere konkret svar.


## Opgave 3 - Test for heteroskedasticitet vha. Breusch-Pagan-testen og specialudgaven af White-testen
```{r}
u = resid(model1)
u2 = u^2
model1u = lm(u2 ~ educ+logbegin+male+minority) #Wooldridge test
summary(model1u)
lm_chi = 0.077789*474
1-pchisq(lm_chi, 4) #p-værdien for chi-square


bptest(model1); summary(model1u)
```

HASHTAG DER ANGIVER KODEN
H0: homoskedasticitet 
BP-værdien på 36.8719 indikerer, at variansen af residualerne ikke er konstant, hvilket også bekræftes ved den lave p-værdi for chi-square. Med den lave p-værdi, kan H0 afvises, hvorfor det tyder på, at der findes heteroskedasticitet.

SKAL KAN REDEGØRES FOR TESTEN?

## Opgave 4 - Beregn robuste standardfejl for modellen og sammenlign med resultaterne i spørgsmål 1
```{r}
model1robust <- coeftest(model1, vcov = vcovHC(model1, type = "HC0"))
screenreg(list(OLS = model1, OLS_robust_se = model1robust), digits = 4)
```
Den venstre kolonne udgør resultaterne fra opgave 1, og den højre kolonne belyser de robuste standardfejl. Der findes en lille ændring i signifikansniveauet, hvor "minority" er signifikant på et højere niveau. Desuden ses der små ændringer i standard error. 

## Opgave 5 - Test hypotesen H0: $\beta_2 = 1$ mod alternativet H1: $\beta_2 \neq 1$
T-test
$$T = \frac{\hat{\beta}_j-a_j}{se(\hat{\beta}_j)}$$
Bruger robust se
$a_j$ er H0
```{r}
#summary(model1)
t = (0.03008211-1) / 0.00296699
t

#kritiske værdier
alpha = c(0.05, 0.01)
qt(1-alpha/2, 469)

#P-værdier - Forkert? im confused
#pt(-abs(t), 469)
```


## Opgave 6 - Test hypotesen H0: $\beta_3 = \beta_4 = 0$
F-test
```{r}
linearHypothesis(model1, c("male=0", "minority=0"))
#model1a = lm(logsal ~ educ+logbegin)
#waldtest(model1, model1a)
```
Lav p-værdi - Afvist H0

## Opgave 7 - Estimer modellen vha. FGLS og kommenter på resultaterne
```{r}
logu2 <- log(resid(model1)^2) #I do everything in one command, i.e., obtain resid, square them, and log them
varreg<-lm(logu2 ~ educ+logbegin+male+minority)
w <- exp(fitted(varreg))
model2fgls = lm(logsal ~ educ+logbegin+male+minority, weight=1/w)
summary(model2fgls)

bptest(model2fgls)
```



## Opgave 8 - Har FGLS estimationen taget højde for al heteroskedasticiteten?
```{r}

```


